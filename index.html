<!doctype html>
<html lang="es">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Ticker Indicadores CL</title>
<style>
  :root{
    --alto: 40px;          /* Ajusta la altura visible del ticker */
    --velocidad: 35s;      /* Ajusta la velocidad de desplazamiento (↓ más grande = más lento) */
    --padX: 24px;          /* Separación entre items */
    --bg: #0b1220;         /* Fondo (oscuro elegante) */
    --fg: #e6edf6;         /* Texto principal */
    --muted: #9fb0c7;      /* Texto secundario */
    --accent: #7cc4ff;     /* Acento */
  }

  html,body{margin:0;padding:0;background:transparent}
  body{font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, "Noto Sans", "Helvetica Neue", sans-serif}

  .ticker-wrap{
    position: relative;
    width: 100%;
    height: var(--alto);
    overflow: hidden;
    background: var(--bg);
    color: var(--fg);
    border: 0;
  }

  /* Sombra suave arriba/abajo para integrar visualmente */
  .ticker-wrap::before,
  .ticker-wrap::after{
    content:"";
    position:absolute;
    left:0; right:0;
    height:8px;
    pointer-events:none;
  }
  .ticker-wrap::before{top:0; background: linear-gradient(to bottom, rgba(0,0,0,.25), rgba(0,0,0,0));}
  .ticker-wrap::after{bottom:0; background: linear-gradient(to top, rgba(0,0,0,.25), rgba(0,0,0,0));}

  .ticker{
    position:absolute;
    display:flex;
    gap: var(--padX);
    white-space: nowrap;
    will-change: transform;
    align-items:center;
    height: 100%;
    animation: scroll var(--velocidad) linear infinite;
  }

  /* Duplicamos el contenido para un bucle sin cortes */
  .ticker > .group{display:flex; gap: var(--padX); align-items:center}
  .item{
    display:flex;
    align-items:baseline;
    gap:10px;
    line-height: 1;
    padding: 0 6px;
  }
  .label{
    font-weight:600;
    letter-spacing:.2px;
    color: var(--muted);
    text-transform: uppercase;
    font-size: 12px;
  }
  .value{
    font-variant-numeric: tabular-nums;
    font-weight:700;
    font-size: 16px;
  }
  .delta{
    font-size: 12px;
    padding: 2px 6px;
    border-radius: 999px;
    background: rgba(124,196,255,.12);
    color: var(--accent);
  }
  .sep{
    opacity:.2;
    font-size:14px;
  }

  @keyframes scroll{
    0%   { transform: translateX(0); }
    100% { transform: translateX(-50%); } /* Se desplazará exactamente el ancho de un grupo */
  }

  /* Responsivo */
  @media (max-width: 480px){
    :root { --alto: 36px; --padX: 16px; }
    .value{font-size:14px}
    .label{font-size:11px}
  }
</style>
</head>
<body>
  <div class="ticker-wrap" role="region" aria-label="Indicadores económicos de Chile">
    <div id="ticker" class="ticker" aria-live="polite">
      <!-- El JS insertará dos .group idénticos para el scroll infinito -->
    </div>
  </div>

<script>
(async function(){
  const endpoint = "https://mindicador.cl/api"; // API pública
  const fallback = {
    uf:       { nombre:"UF",      valor: 36000, unidad:"CLP" },
    dolar:    { nombre:"Dólar",   valor: 950,   unidad:"CLP" },
    ipc:      { nombre:"IPC",     valor: 0.4,   unidad:"%" }
  };

  function fmtCLP(n){
    try { return n.toLocaleString('es-CL', { style:'currency', currency:'CLP', maximumFractionDigits:0 }); }
    catch{ return `$${Math.round(n).toString().replace(/\B(?=(\d{3})+(?!\d))/g,'.')}`; }
  }
  function fmtPct(n){ return (Number(n).toFixed(2).replace('.',',')) + '%' }

  function buildItems(data){
    const items = [];

    // UF
    if(data.uf){
      items.push({
        label: 'UF',
        value: fmtCLP(data.uf.valor),
        delta: data.uf.fecha ? new Date(data.uf.fecha).toLocaleDateString('es-CL') : ''
      });
    }
    // Dólar
    if(data.dolar){
      items.push({
        label: 'DÓLAR',
        value: fmtCLP(data.dolar.valor),
        delta: data.dolar.fecha ? new Date(data.dolar.fecha).toLocaleDateString('es-CL') : ''
      });
    }
    // IPC (variación mensual)
    if(data.ipc){
      items.push({
        label: 'IPC',
        value: fmtPct(data.ipc.serie?.[0]?.valor ?? data.ipc.valor ?? 0),
        delta: data.ipc.serie?.[0]?.fecha ? new Date(data.ipc.serie[0].fecha).toLocaleDateString('es-CL') : ''
      });
    }

    // Puedes añadir más: euro, utm, tpm, etc. siguiendo el mismo patrón.

    return items;
  }

  function renderTicker(items){
    const ticker = document.getElementById('ticker');

    function groupHTML(){
      return `
        <div class="group">
          ${items.map((it,i)=>`
            <div class="item" aria-label="${it.label} ${it.value}">
              <span class="label">${it.label}</span>
              <span class="value">${it.value}</span>
              ${it.delta ? `<span class="delta">${it.delta}</span>` : ``}
            </div>
            ${i < items.length-1 ? `<span class="sep">|</span>` : ``}
          `).join('')}
        </div>
      `;
    }

    // Duplicamos el grupo para scroll continuo
    ticker.innerHTML = groupHTML() + groupHTML();

    // Ajuste de velocidad según contenido (opcional)
    // Si el texto es muy largo, aumentamos duración para que sea más legible
    const totalWidth = ticker.scrollWidth / 2; // ancho de un grupo
    const pxPerSec = 10; // 10px/seg aprox
    const duration = Math.max(20, Math.round(totalWidth / pxPerSec));
    ticker.style.animationDuration = duration + 's';
  }

  async function load(){
    let data;
    try{
      const res = await fetch(endpoint, { cache: "no-store" });
      if(!res.ok) throw new Error(res.statusText);
      const json = await res.json();
      // La API devuelve objetos por indicador; para IPC trae "serie" con últimos valores
      data = {
        uf: json.uf ? { valor: json.uf.valor, fecha: json.uf.fecha } : null,
        dolar: json.dolar ? { valor: json.dolar.valor, fecha: json.dolar.fecha } : null,
        ipc: json.ipc ? { serie: json.ipc.serie } : null
      };
    }catch(e){
      console.warn('Fallo al cargar API, usando valores de respaldo:', e);
      data = fallback;
    }

    const items = buildItems(data);
    renderTicker(items);
  }

  load();

  // Refresca cada 6 horas (ajusta si prefieres)
  setInterval(load, 6 * 60 * 60 * 1000);
})();
</script>
</body>
</html>
